<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Knowledge Graph System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_analysis.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Advanced Knowledge Graph System</h1>
            <p>Knowledge Graph Visualization and Analysis Platform</p>
        </header>


        <div class="main-content">
            <div class="left-panel">
                <!-- Îç∞Ïù¥ÌÑ∞ ÏóÖÎ°úÎìú ÏÑπÏÖò -->
                <div class="control-section">
                    <h3>üìÅ Data Upload</h3>
                    <div class="compact-upload-area" id="fileUploadArea">
                        <input type="file" id="fileInput" accept=".csv,.json,.pdf" multiple style="display: none;">
                        <button class="compact-upload-btn" id="selectFileBtn">
                            Select File
                        </button>
                        <div class="file-types-compact">
                            <span class="file-type-small">CSV</span>
                            <span class="file-type-small">JSON</span>
                            <span class="file-type-small">PDF</span>
                        </div>
                        <div class="upload-status-compact" id="uploadStatus" style="display: none;">
                            <div class="status-text-small">Processing...</div>
                            <div class="progress-bar-small">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Îç∞Ïù¥ÌÑ∞ ÌïÑÌÑ∞ ÏÑπÏÖò -->
                <div class="control-section">
                    <h3>üìä Data Filter</h3>
                    <div class="filter-group">
                        <label>Node Size Threshold:</label>
                        <input type="range" id="nodeSizeThreshold" min="0" max="100" value="20">
                        <span id="nodeSizeValue">20</span>
                    </div>
                    <div class="filter-group">
                        <label>Edge Weight Threshold:</label>
                        <input type="range" id="edgeWeightThreshold" min="0" max="10" value="1">
                        <span id="edgeWeightValue">1</span>
                    </div>
                    <div class="filter-group">
                        <label>Max Nodes to Display:</label>
                        <input type="range" id="maxNodesDisplay" min="10" max="200" value="50">
                        <span id="maxNodesValue">50</span>
                    </div>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="progressiveLoading" checked>
                            Progressive Loading
                        </label>
                    </div>
                </div>

                <!-- ÎÖ∏Îìú Í≤ÄÏÉâ ÏÑπÏÖò -->
                <div class="control-section">
                    <h3>üîç Node Search</h3>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Search nodes...">
                        <span class="search-icon">üîç</span>
                    </div>
                    <div id="searchResults" class="search-results"></div>
                </div>

                <!-- ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ ÏÑπÏÖò -->
                <div class="control-section">
                    <h3>üìà Performance Info</h3>
                    <div class="performance-stats">
                        <div>FPS: <span id="fpsCounter">0</span></div>
                        <div>Rendering: <span id="renderTime">0ms</span></div>
                        <div>Nodes: <span id="visibleNodes">0</span></div>
                        <div>Edges: <span id="visibleEdges">0</span></div>
                    </div>
                </div>
            </div>

            <div class="center-panel">
                <div class="visualization-container" id="visualizationContainer">
                    <svg id="graph" width="100%" height="100%"></svg>
                    <div class="loading-overlay" id="loadingOverlay">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading knowledge graph...</div>
                    </div>
                </div>
            </div>

            <div class="right-panel" id="rightPanel">
                <!-- Í∑∏ÎûòÌîÑ Ï†úÏñ¥ ÏÑπÏÖò -->
                <div class="control-section">
                    <h3>üéÆ Graph Control</h3>
                    <div class="control-buttons">
                        <button class="control-btn" id="zoomInBtn" title="Zoom In">
                            <span class="btn-icon">+</span>
                        </button>
                        <button class="control-btn" id="zoomOutBtn" title="Zoom Out">
                            <span class="btn-icon">‚àí</span>
                        </button>
                        <button class="control-btn" id="resetBtn" title="Reset">
                            <span class="btn-icon">‚Ü∫</span>
                        </button>
                        <button class="control-btn" id="exportBtn" title="Export">
                            <span class="btn-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <!-- Analysis Results ÏÑπÏÖò -->
                <div class="control-section">
                    <h3>üìä Analysis Results</h3>
                    <div class="analysis-controls">
                        <button id="peoAnalysisBtn" class="analysis-btn" onclick="openAnalysisPopup('peo')">üîç PEO Analysis</button>
                        <button id="networkAnalysisBtn" class="analysis-btn" onclick="openAnalysisPopup('network')">üåê Network Analysis</button>
                        <button id="aiInsightBtn" class="analysis-btn" onclick="openAnalysisPopup('insights')">ü§ñ AI Insights</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üìù Console</h3>
                    <div class="console-window" id="consoleWindow">
                        <div class="console-header">
                            <span>System Log</span>
                            <button class="clear-console" onclick="clearConsole()">üóëÔ∏è</button>
                        </div>
                        <div class="console-content" id="consoleContent">
                            <div class="console-message">System is ready.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÎÖ∏Îìú ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ìå®ÎÑê -->
        <div id="nodeDetailsPanel" class="node-details-panel">
            <div class="panel-header">
                <h3>Node Details</h3>
                <button class="close-btn" onclick="hideNodeDetails()">√ó</button>
            </div>
            <div class="panel-content">
                <div class="node-info">
                    <h4 id="nodeTitle">Node Title</h4>
                    <p id="nodeType">Type: <span></span></p>
                    <p id="nodeSize">Size: <span></span></p>
                </div>
                
                <div class="properties-section">
                    <h5>Properties</h5>
                    <div id="propertiesList" class="properties-list"></div>
                </div>
                
                <div class="formula-section" style="display: none;">
                    <h5>Formula</h5>
                    <div id="formulaDisplay" class="formula-display"></div>
                </div>
                
                <div class="references-section" style="display: none;">
                    <h5>References</h5>
                    <div id="referencesList" class="references-list"></div>
                </div>
            </div>
        </div>

        <!-- ÌôïÏû• Í∞ÄÎä•Ìïú AI ÏõåÌÅ¨Ïä§ÌéòÏù¥Ïä§ -->
        <div id="aiWorkspace" class="ai-workspace" style="display: none;">
            <div class="ai-workspace-header">
                <h2>ü§ñ AI Workspace</h2>
                <button class="close-workspace-btn" onclick="toggleAIPanel()">√ó</button>
            </div>
            <div class="ai-workspace-content">
                <div class="ai-tabs">
                    <button class="ai-tab active" onclick="switchAITab('analysis')">üîç Graph Analysis</button>
                    <button class="ai-tab" onclick="switchAITab('keywords')">üè∑Ô∏è Keyword Extraction</button>
                    <button class="ai-tab" onclick="switchAITab('chat')">üí¨ AI Chat</button>
                </div>
                
                <div id="analysisTab" class="ai-tab-content active">
                    <h4>Graph Structure Analysis</h4>
                    <button class="ai-action-btn" onclick="analyzeGraphStructure()">Analyze Structure</button>
                    <button class="ai-action-btn" onclick="findCommunities()">Detect Communities</button>
                    <button class="ai-action-btn" onclick="identifyKeyNodes()">Identify Key Nodes</button>
                    <div id="analysisResults" class="ai-results"></div>
                </div>
                
                <div id="keywordsTab" class="ai-tab-content">
                    <h4>Keyword & Concept Analysis</h4>
                    <button class="ai-action-btn" onclick="extractKeywords()">Extract Keywords</button>
                    <button class="ai-action-btn" onclick="suggestConnections()">Suggest Connections</button>
                    <button class="ai-action-btn" onclick="categorizeNodes()">Categorize Nodes</button>
                    <div id="keywordResults" class="ai-results"></div>
                </div>
                
                <div id="chatTab" class="ai-tab-content">
                    <h4>Chat with AI</h4>
                    <div class="ai-chat-area">
                        <div id="chatHistory" class="chat-history"></div>
                        <div class="chat-input-area">
                            <input type="text" id="chatInput" placeholder="Ask AI anything..." onkeypress="if(event.key==='Enter') sendChatMessage()">
                            <button onclick="sendChatMessage()">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ìà¥ÌåÅ -->
        <div id="tooltip" style="position: absolute; display: none; background: rgba(0,0,0,0.9); color: white; padding: 10px; border-radius: 5px; font-size: 12px; z-index: 1000; max-width: 300px;"></div>
    </div>

    <!-- Transformers.js ÎùºÏù¥Î∏åÎü¨Î¶¨ (BERT Î™®Îç∏Ïö©) -->
    <script type="module">
        // Transformers.js ÎèôÏ†Å Î°úÎìú
        try {
            const { pipeline, env } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0');
            
            // WASM Î∞è Ï∫êÏãú ÏÑ§Ï†ï
            env.allowRemoteModels = true;
            env.useBrowserCache = true;
            env.allowLocalModels = false;
            
            // Ï†ÑÏó≠ Í∞ùÏ≤¥Ïóê Ï†ÄÏû•
            window.transformersJS = { pipeline, env };
            
            console.log('‚úÖ Transformers.js Î°úÎìú ÏôÑÎ£å');
            
            // Transformers.js Î°úÎìú ÏôÑÎ£å ÌõÑ BERT Î™®Îç∏ Ï¥àÍ∏∞Ìôî ÏãúÎèÑ
            window.dispatchEvent(new CustomEvent('transformersLoaded'));
            
        } catch (error) {
            console.warn('‚ö†Ô∏è Transformers.js Î°úÎìú Ïã§Ìå®:', error);
            console.log('Ìè¥Î∞± Î™®ÎìúÎ°ú ÎèôÏûëÌï©ÎãàÎã§.');
            
            // Î°úÎìú Ïã§Ìå® ÏãúÏóêÎèÑ Ïù¥Î≤§Ìä∏ Î∞úÏÉù
            window.dispatchEvent(new CustomEvent('transformersLoaded'));
        }
    </script>
    
    <!-- JavaScript Î™®ÎìàÎì§ -->
    <script src="js/config.js"></script>
    <script src="js/aiService.js"></script>
    <script src="js/dataProcessor.js"></script>
    <script src="js/visualization.js"></script>
    <script src="js/uiManager.js"></script>
    <script src="js/pdfParser.js"></script>
    <script src="js/backendAPI.js"></script>
    <script src="js/analysisPanel.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Ï†ÑÏó≠ BERT Î™®Îç∏ Îß§ÎãàÏ†Ä Ï¥àÍ∏∞Ìôî -->
    <script>
        // Transformers.js Î°úÎìú ÏôÑÎ£å ÌõÑ BERT Î™®Îç∏ Ï¥àÍ∏∞Ìôî
        window.addEventListener('transformersLoaded', async () => {
            console.log('üöÄ BERT Î™®Îç∏ Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
            
            // Ïû†Ïãú ÎåÄÍ∏∞ÌïòÏó¨ Î™®Îì† Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä ÌååÏã±ÎêòÎèÑÎ°ù Ìï®
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Backend API client status check
            if (window.backendAPI) {
                const status = window.backendAPI.getStatus();
                console.log('üîå Backend API status:', status);
                
                if (status.enabled) {
                    console.log('‚úÖ OpenAI analysis features available');
                } else {
                    console.log('üîÑ Local mode (backend optional)');
                }
            } else {
                console.error('‚ùå BackendAPI not found');
            }
            
            // Î©îÏù∏ Ïï± Ï¥àÍ∏∞Ìôî
            if (typeof KnowledgeGraphApp !== 'undefined') {
                window.app = new KnowledgeGraphApp();
                console.log('‚úÖ KnowledgeGraphApp Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
            } else {
                console.error('‚ùå KnowledgeGraphApp ÌÅ¥ÎûòÏä§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }
        });
        
        // DOM Î°úÎìú ÏôÑÎ£å ÏãúÏóêÎèÑ ÌôïÏù∏
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM Î°úÎìú ÏôÑÎ£å');
        });
    </script>
</body>
</html>