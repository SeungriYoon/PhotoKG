<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Knowledge Graph System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_analysis.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§  Advanced Knowledge Graph System</h1>
            <p>Knowledge Graph Visualization and Analysis Platform</p>
        </header>


        <div class="main-content">
            <div class="left-panel">
                <!-- ë°ì´í„° ì—…ë¡œë“œ ì„¹ì…˜ -->
                <div class="control-section">
                    <h3>ğŸ“ Data Upload</h3>
                    <div class="compact-upload-area" id="fileUploadArea">
                        <input type="file" id="fileInput" accept=".csv,.json,.pdf" multiple style="display: none;">
                        <button class="compact-upload-btn" id="selectFileBtn">
                            Select File
                        </button>
                        <div class="file-types-compact">
                            <span class="file-type-small">CSV</span>
                            <span class="file-type-small">JSON</span>
                            <span class="file-type-small">PDF</span>
                        </div>
                        <div class="upload-status-compact" id="uploadStatus" style="display: none;">
                            <div class="status-text-small">Processing...</div>
                            <div class="progress-bar-small">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë°ì´í„° í•„í„° ì„¹ì…˜ -->
                <div class="control-section">
                    <h3>ğŸ“Š Data Filter</h3>
                    <div class="filter-group">
                        <label>Node Size Threshold:</label>
                        <input type="range" id="nodeSizeThreshold" min="0" max="100" value="20">
                        <span id="nodeSizeValue">20</span>
                    </div>
                    <div class="filter-group">
                        <label>Edge Weight Threshold:</label>
                        <input type="range" id="edgeWeightThreshold" min="0" max="10" value="1">
                        <span id="edgeWeightValue">1</span>
                    </div>
                    <div class="filter-group">
                        <label>Max Nodes to Display:</label>
                        <input type="range" id="maxNodesDisplay" min="10" max="200" value="50">
                        <span id="maxNodesValue">50</span>
                    </div>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="progressiveLoading" checked>
                            Progressive Loading
                        </label>
                    </div>
                </div>

                <!-- ë…¸ë“œ ê²€ìƒ‰ ì„¹ì…˜ -->
                <div class="control-section">
                    <h3>ğŸ” Node Search</h3>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Search nodes...">
                        <span class="search-icon">ğŸ”</span>
                    </div>
                    <div id="searchResults" class="search-results"></div>
                </div>

                <!-- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì„¹ì…˜ -->
                <div class="control-section">
                    <h3>ğŸ“ˆ Performance Info</h3>
                    <div class="performance-stats">
                        <div>FPS: <span id="fpsCounter">0</span></div>
                        <div>Rendering: <span id="renderTime">0ms</span></div>
                        <div>Nodes: <span id="visibleNodes">0</span></div>
                        <div>Edges: <span id="visibleEdges">0</span></div>
                    </div>
                </div>
            </div>

            <div class="center-panel">
                <div class="visualization-container" id="visualizationContainer">
                    <svg id="graph" width="100%" height="100%"></svg>
                    <div class="loading-overlay" id="loadingOverlay">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading knowledge graph...</div>
                    </div>
                </div>
            </div>

            <div class="right-panel" id="rightPanel">
                <!-- ê·¸ë˜í”„ ì œì–´ ì„¹ì…˜ -->
                <div class="control-section">
                    <h3>ğŸ® Graph Control</h3>
                    <div class="control-buttons">
                        <button class="control-btn" id="zoomInBtn" title="Zoom In">
                            <span class="btn-icon">+</span>
                        </button>
                        <button class="control-btn" id="zoomOutBtn" title="Zoom Out">
                            <span class="btn-icon">âˆ’</span>
                        </button>
                        <button class="control-btn" id="resetBtn" title="Reset">
                            <span class="btn-icon">â†º</span>
                        </button>
                        <button class="control-btn" id="exportBtn" title="Export">
                            <span class="btn-icon">ğŸ’¾</span>
                        </button>
                    </div>
                </div>

                <!-- Analysis Results ì„¹ì…˜ -->
                <div class="control-section">
                    <h3>ğŸ“Š Analysis Results</h3>
                    <div class="analysis-controls">
                        <button id="peoAnalysisBtn" class="analysis-btn" onclick="openAnalysisPopup('peo')">ğŸ” PEO Analysis</button>
                        <button id="networkAnalysisBtn" class="analysis-btn" onclick="openAnalysisPopup('network')">ğŸŒ Network Analysis</button>
                        <button id="aiInsightBtn" class="analysis-btn" onclick="openAnalysisPopup('insights')">ğŸ¤– AI Insights</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>ğŸ“ Console</h3>
                    <div class="console-window" id="consoleWindow">
                        <div class="console-header">
                            <span>System Log</span>
                            <button class="clear-console" onclick="clearConsole()">ğŸ—‘ï¸</button>
                        </div>
                        <div class="console-content" id="consoleContent">
                            <div class="console-message">System is ready.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë…¸ë“œ ìƒì„¸ ì •ë³´ íŒ¨ë„ -->
        <div id="nodeDetailsPanel" class="node-details-panel">
            <div class="panel-header">
                <h3>Node Details</h3>
                <button class="close-btn" onclick="hideNodeDetails()">Ã—</button>
            </div>
            <div class="panel-content">
                <div class="node-info">
                    <h4 id="nodeTitle">Node Title</h4>
                    <p id="nodeType">Type: <span></span></p>
                    <p id="nodeSize">Size: <span></span></p>
                </div>
                
                <div class="properties-section">
                    <h5>Properties</h5>
                    <div id="propertiesList" class="properties-list"></div>
                </div>
                
                <div class="formula-section" style="display: none;">
                    <h5>Formula</h5>
                    <div id="formulaDisplay" class="formula-display"></div>
                </div>
                
                <div class="references-section" style="display: none;">
                    <h5>References</h5>
                    <div id="referencesList" class="references-list"></div>
                </div>
            </div>
        </div>

        <!-- í™•ì¥ ê°€ëŠ¥í•œ AI ì›Œí¬ìŠ¤í˜ì´ìŠ¤ -->
        <div id="aiWorkspace" class="ai-workspace" style="display: none;">
            <div class="ai-workspace-header">
                <h2>ğŸ¤– AI Workspace</h2>
                <button class="close-workspace-btn" onclick="toggleAIPanel()">Ã—</button>
            </div>
            <div class="ai-workspace-content">
                <div class="ai-tabs">
                    <button class="ai-tab active" onclick="switchAITab('analysis')">ğŸ” Graph Analysis</button>
                    <button class="ai-tab" onclick="switchAITab('keywords')">ğŸ·ï¸ Keyword Extraction</button>
                    <button class="ai-tab" onclick="switchAITab('chat')">ğŸ’¬ AI Chat</button>
                </div>
                
                <div id="analysisTab" class="ai-tab-content active">
                    <h4>Graph Structure Analysis</h4>
                    <button class="ai-action-btn" onclick="analyzeGraphStructure()">Analyze Structure</button>
                    <button class="ai-action-btn" onclick="findCommunities()">Detect Communities</button>
                    <button class="ai-action-btn" onclick="identifyKeyNodes()">Identify Key Nodes</button>
                    <div id="analysisResults" class="ai-results"></div>
                </div>
                
                <div id="keywordsTab" class="ai-tab-content">
                    <h4>Keyword & Concept Analysis</h4>
                    <button class="ai-action-btn" onclick="extractKeywords()">Extract Keywords</button>
                    <button class="ai-action-btn" onclick="suggestConnections()">Suggest Connections</button>
                    <button class="ai-action-btn" onclick="categorizeNodes()">Categorize Nodes</button>
                    <div id="keywordResults" class="ai-results"></div>
                </div>
                
                <div id="chatTab" class="ai-tab-content">
                    <h4>Chat with AI</h4>
                    <div class="ai-chat-area">
                        <div id="chatHistory" class="chat-history"></div>
                        <div class="chat-input-area">
                            <input type="text" id="chatInput" placeholder="Ask AI anything..." onkeypress="if(event.key==='Enter') sendChatMessage()">
                            <button onclick="sendChatMessage()">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- íˆ´íŒ -->
        <div id="tooltip" style="position: absolute; display: none; background: rgba(0,0,0,0.9); color: white; padding: 10px; border-radius: 5px; font-size: 12px; z-index: 1000; max-width: 300px;"></div>
    </div>

    <!-- Transformers.js ë¼ì´ë¸ŒëŸ¬ë¦¬ (BERT ëª¨ë¸ìš©) -->
    <script type="module">
        // Transformers.js ë™ì  ë¡œë“œ
        try {
            const { pipeline, env } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0');
            
            // WASM ë° ìºì‹œ ì„¤ì •
            env.allowRemoteModels = true;
            env.useBrowserCache = true;
            env.allowLocalModels = false;
            
            // ì „ì—­ ê°ì²´ì— ì €ì¥
            window.transformersJS = { pipeline, env };
            
            console.log('âœ… Transformers.js ë¡œë“œ ì™„ë£Œ');
            
            // Transformers.js ë¡œë“œ ì™„ë£Œ í›„ BERT ëª¨ë¸ ì´ˆê¸°í™” ì‹œë„
            window.dispatchEvent(new CustomEvent('transformersLoaded'));
            
        } catch (error) {
            console.warn('âš ï¸ Transformers.js ë¡œë“œ ì‹¤íŒ¨:', error);
            console.log('í´ë°± ëª¨ë“œë¡œ ë™ì‘í•©ë‹ˆë‹¤.');
            
            // ë¡œë“œ ì‹¤íŒ¨ ì‹œì—ë„ ì´ë²¤íŠ¸ ë°œìƒ
            window.dispatchEvent(new CustomEvent('transformersLoaded'));
        }
    </script>
    
    <!-- JavaScript ëª¨ë“ˆë“¤ -->
    <script src="js/config.js"></script>
    <script src="js/aiService.js"></script>
    <script src="js/dataProcessor.js"></script>
    <script src="js/visualization.js"></script>
    <script src="js/uiManager.js"></script>
    <script src="js/pdfParser.js"></script>
    <script src="js/backendAPI.js"></script>
    <script src="js/peoAnalyzer.js"></script>
    <script src="js/analysisPanel.js"></script>
    <script src="js/main.js"></script>
    
</body>
</html>